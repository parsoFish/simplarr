# =============================================================================
# Simplarr Nginx Configuration - Unified Setup
# =============================================================================
# All services run on a SINGLE machine. Access via:
#   - Path-based:   http://<host>/plex, /radarr, /sonarr, etc.
#   - Subdomain:    http://plex.local, radarr.local (requires DNS setup)
# =============================================================================

# -----------------------------------------------------------------------------
# Main Entry Point - Homepage + Path-Based Access
# -----------------------------------------------------------------------------
server {
    listen 80 default_server;
    server_name _;

    # Homepage Dashboard
    location = / {
        proxy_pass http://homepage:80/;
        proxy_http_version 1.1;
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
        proxy_set_header X-Forwarded-Port $server_port;
        proxy_set_header X-Forwarded-Proto $scheme;
    }

    # Status Page
    location = /status {
        proxy_pass http://homepage:80/status.html;
        proxy_http_version 1.1;
        proxy_set_header Host $host;
    }

    # Plex - via host network
    location /plex {
        return 302 https://host.docker.internal:32400/web;
    }

    # Radarr
    location /radarr {
        proxy_pass http://radarr:7878;
        proxy_http_version 1.1;
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
        proxy_set_header X-Forwarded-Port $server_port;
        proxy_set_header X-Forwarded-Proto $scheme;
    }

    # Sonarr
    location /sonarr {
        proxy_pass http://sonarr:8989;
        proxy_http_version 1.1;
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
        proxy_set_header X-Forwarded-Port $server_port;
        proxy_set_header X-Forwarded-Proto $scheme;
    }

    # Prowlarr
    location /prowlarr {
        proxy_pass http://prowlarr:9696;
        proxy_http_version 1.1;
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
        proxy_set_header X-Forwarded-Port $server_port;
        proxy_set_header X-Forwarded-Proto $scheme;
    }

    # Overseerr
    location /overseerr {
        proxy_pass http://overseerr:5055;
        proxy_http_version 1.1;
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
        proxy_set_header X-Forwarded-Port $server_port;
        proxy_set_header X-Forwarded-Proto $scheme;
    }

    # qBittorrent
    location /torrent {
        proxy_pass http://qbittorrent:8080/;
        proxy_http_version 1.1;
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
        proxy_set_header X-Forwarded-Port $server_port;
        proxy_set_header X-Forwarded-Proto $scheme;
        proxy_set_header Referer "";
        proxy_set_header Origin "";
    }

    # Tautulli
    location /tautulli {
        proxy_pass http://tautulli:8181;
        proxy_http_version 1.1;
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
        proxy_set_header X-Forwarded-Port $server_port;
        proxy_set_header X-Forwarded-Proto $scheme;
    }
}

# -----------------------------------------------------------------------------
# Subdomain Access (requires DNS pointing *.local to this host)
# -----------------------------------------------------------------------------

# Homepage
server {
    listen 80;
    server_name home.local home.localhost;

    location / {
        proxy_pass http://homepage:80;
        proxy_http_version 1.1;
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
        proxy_set_header X-Forwarded-Port $server_port;
        proxy_set_header X-Forwarded-Proto $scheme;
    }
}

# Plex Media Server
server {
    listen 80;
    server_name plex.local plex.localhost;

    location / {
        proxy_pass https://host.docker.internal:32400/;
        proxy_http_version 1.1;
        proxy_ssl_verify off;
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
        proxy_set_header X-Forwarded-Port $server_port;
        proxy_set_header X-Forwarded-Proto $scheme;
        proxy_buffering off;
    }
}

# qBittorrent
server {
    listen 80;
    server_name torrent.local qbittorrent.local;

    location / {
        proxy_pass http://qbittorrent:8080/;
        proxy_http_version 1.1;
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
        proxy_set_header X-Forwarded-Port $server_port;
        proxy_set_header X-Forwarded-Proto $scheme;
        proxy_set_header Referer "";
        proxy_set_header Origin "";
    }
}

# Radarr
server {
    listen 80;
    server_name radarr.local;

    location / {
        proxy_pass http://radarr:7878;
        proxy_http_version 1.1;
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
        proxy_set_header X-Forwarded-Port $server_port;
        proxy_set_header X-Forwarded-Proto $scheme;
    }
}

# Sonarr
server {
    listen 80;
    server_name sonarr.local;

    location / {
        proxy_pass http://sonarr:8989;
        proxy_http_version 1.1;
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
        proxy_set_header X-Forwarded-Port $server_port;
        proxy_set_header X-Forwarded-Proto $scheme;
    }
}

# Prowlarr
server {
    listen 80;
    server_name prowlarr.local;

    location / {
        proxy_pass http://prowlarr:9696;
        proxy_http_version 1.1;
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
        proxy_set_header X-Forwarded-Port $server_port;
        proxy_set_header X-Forwarded-Proto $scheme;
    }
}

# Overseerr
server {
    listen 80;
    server_name overseerr.local requests.local;

    location / {
        proxy_pass http://overseerr:5055;
        proxy_http_version 1.1;
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
        proxy_set_header X-Forwarded-Port $server_port;
        proxy_set_header X-Forwarded-Proto $scheme;
    }
}

# Tautulli
server {
    listen 80;
    server_name tautulli.local;

    location / {
        proxy_pass http://tautulli:8181;
        proxy_http_version 1.1;
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
        proxy_set_header X-Forwarded-Port $server_port;
        proxy_set_header X-Forwarded-Proto $scheme;
    }
}
