# =============================================================================
# Simplarr - Pi/Server Services (Split Setup)
# =============================================================================
# This compose file is for the Pi/Server in a split NAS+Pi deployment.
#
# PREREQUISITES:
#   1. NAS media folders mounted via NFS to /mnt/nas/
#      Example /etc/fstab entry:
#        192.168.1.100:/volume1/media /mnt/nas nfs defaults 0 0
#
#   2. Mount should contain: downloads/, movies/, tv/
#
#   3. Update nginx/split.conf with your NAS IP (or run setup.sh on Pi)
#
# If your NFS mount is at a different path, update the volume mappings below.
# =============================================================================

services:
  radarr:
    image: linuxserver/radarr:latest
    container_name: radarr
    ports:
      - 7878:7878
    environment:
      - PUID=${PUID}
      - PGID=${PGID}
      - TZ=${TZ}
    volumes:
      - ${DOCKER_CONFIG}/radarr:/config
      - /mnt/nas/downloads:/downloads
      - /mnt/nas/movies:/movies
    healthcheck:
      test: curl -f http://localhost:7878/ping || exit 1
      interval: 30s
      timeout: 10s
      retries: 3
      start_period: 30s
    restart: unless-stopped

  sonarr:
    image: linuxserver/sonarr:latest
    container_name: sonarr
    ports:
      - 8989:8989
    environment:
      - PUID=${PUID}
      - PGID=${PGID}
      - TZ=${TZ}
    volumes:
      - ${DOCKER_CONFIG}/sonarr:/config
      - /mnt/nas/downloads:/downloads
      - /mnt/nas/tv:/tv
    healthcheck:
      test: curl -f http://localhost:8989/ping || exit 1
      interval: 30s
      timeout: 10s
      retries: 3
      start_period: 30s
    restart: unless-stopped

  prowlarr:
    image: linuxserver/prowlarr:latest
    container_name: prowlarr
    ports:
      - 9696:9696
    environment:
      - PUID=${PUID}
      - PGID=${PGID}
      - TZ=${TZ}
    volumes:
      - ${DOCKER_CONFIG}/prowlarr:/config
    healthcheck:
      test: curl -f http://localhost:9696/ping || exit 1
      interval: 30s
      timeout: 10s
      retries: 3
      start_period: 30s
    restart: unless-stopped

  tautulli:
    image: linuxserver/tautulli:latest
    container_name: tautulli
    ports:
      - 8181:8181
    environment:
      - PUID=${PUID}
      - PGID=${PGID}
      - TZ=${TZ}
    volumes:
      - ${DOCKER_CONFIG}/tautulli:/config
      - /mnt/nas/movies:/movies
      - /mnt/nas/tv:/tv
    healthcheck:
      test: curl -f http://localhost:8181/status || exit 1
      interval: 30s
      timeout: 10s
      retries: 3
      start_period: 30s
    restart: unless-stopped

  # Reverse Proxy
  # NOTE: Edit nginx/split.conf and replace YOUR_NAS_IP with your NAS IP address
  nginx:
    image: nginx:latest
    container_name: nginx
    ports:
      - "80:80"
      - "443:443"
    volumes:
      - ${DOCKER_CONFIG}/nginx/ssl:/etc/nginx/ssl:ro
      - ./nginx/split.conf:/etc/nginx/conf.d/default.conf:ro
      - ${DOCKER_CONFIG}/nginx/logs:/var/log/nginx
    healthcheck:
      test: curl -f http://localhost:80 || exit 1
      interval: 30s
      timeout: 10s
      retries: 3
      start_period: 10s
    restart: unless-stopped

  overseerr:
    image: sctx/overseerr:latest
    container_name: overseerr
    ports:
      - 5055:5055
    environment:
      - TZ=${TZ}
      - LOG_LEVEL=info
    volumes:
      - ${DOCKER_CONFIG}/overseerr:/app/config
    healthcheck:
      test: wget -q --spider http://localhost:5055/api/v1/status || exit 1
      interval: 30s
      timeout: 10s
      retries: 3
      start_period: 30s
    restart: unless-stopped

  homepage:
    build: ./homepage
    container_name: homepage
    expose:
      - "80"
    healthcheck:
      test: curl -f http://localhost:80 || exit 1
      interval: 30s
      timeout: 10s
      retries: 3
      start_period: 10s
    restart: unless-stopped

networks:
  default:
    name: media-network

